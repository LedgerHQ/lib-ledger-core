<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.15"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>ledger-core: Ledger Core Library</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">ledger-core
   &#160;<span id="projectnumber">3.2.1</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.15 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">Ledger Core Library </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><ul>
<li><a href="#clone-project">Clone project</a></li>
<li><a href="#dependencies">Dependencies</a><ul>
<li><a href="#build">Build</a></li>
<li><a href="#external-dependencies">External dependencies:</a></li>
</ul>
</li>
<li><a href="#build-of-c-library">Build of C++ library</a><ul>
<li><a href="#building-for-jni">Building for JNI</a></li>
<li><a href="#build-library-on-docker">Build library on docker</a></li>
</ul>
</li>
<li><a href="#documentation">Documentation</a></li>
<li><a href="#binding-to-nodejs">Binding to node.js</a><ul>
<li><a href="#using-the-node-module">Using the node module</a></li>
<li><a href="#generating-a-new-node-module-for-your-system">Generating a new node module for your system</a></li>
</ul>
</li>
<li><a href="#test-nodejs">Test NodeJs</a></li>
<li><a href="#support">Support</a><ul>
<li><a href="#libcore">Libcore:</a></li>
<li><a href="#bindings">Bindings:</a></li>
</ul>
</li>
<li><a href="#developement-guidelines">Developement guidelines</a><ul>
<li><a href="#ci">CI</a></li>
</ul>
</li>
<li><a href="#qa-and-troubleshooting">Q/A and troubleshooting</a><ul>
<li><a href="#i-have-updated-an-include-file-and-test-code-doesnt-see-the-changes">I have updated an include file and test code doesn’t see the changes!</a></li>
<li><a href="#i-have-upgraded-my-macosx-system-and-now-i-cant-compile-anymore">I have upgraded my macOSX system and now I can’t compile anymore.</a></li>
</ul>
</li>
</ul>
<p>Core library which will be used by Ledger applications.</p>
<blockquote class="doxtable">
<p>If you’re a developer and want to contribute, please refer to our contribution guidelines specific documentation. </p>
</blockquote>
<h2>Clone project</h2>
<div class="fragment"><div class="line">git clone --recurse-submodules https://github.com/LedgerHQ/lib-ledger-core.git</div></div><!-- fragment --><blockquote class="doxtable">
<p>If you had already forked / cloned the repository before issuing that command, it’s okay. You can initiate the submodules with the following commands: </p>
</blockquote>
<div class="fragment"><div class="line">cd lib-ledger-core</div><div class="line">git submodule init</div><div class="line">git submodule update</div></div><!-- fragment --><h2>Dependencies</h2>
<h3>Build</h3>
<p>This project is based on **_cmake_** as a build system so you should install it before starting (at least version 3.7).</p>
<h3>External dependencies:</h3>
<ul>
<li><a href="https://www.qt.io/download">Qt5</a> is needed to build tests of the library.</li>
<li>Generation of binding is automated with <a href="https://github.com/dropbox/djinni">Djinni</a>.</li>
<li>Build on multiple Operating Systems is based on <a href="https://github.com/ruslo/polly">polly</a> toolchains.</li>
</ul>
<h2>Build of C++ library</h2>
<p>**_cmake_** is building out of source, you should create a build directory (e.g. <code>lib-ledger-core-build</code>): </p><pre class="fragment">.                           # Directory where clone command was launched
├── lib-ledger-core         # Source files directory
├── lib-ledger-core-build   # Build directory
</pre><p>If you respect this folder structure (and naming), after <code>cd lib-ledger-core-build</code>, you can build the library by running:</p>
<div class="fragment"><div class="line">cmake -DCMAKE_INSTALL_PREFIX=/path/to/qt5 ../lib-ledger-core &amp;&amp; make</div></div><!-- fragment --><blockquote class="doxtable">
<p>(<em>macOSX users</em>) If you struggle to find where Qt5 is located, for example, on <code>macOSX</code>, <code>qt5</code> can be found at: </p>
</blockquote>
<div class="fragment"><div class="line">/usr/local/Cellar/qt/&lt;qt_version&gt;/bin</div></div><!-- fragment --><p>Several CMake arguments might interest you there:</p>
<ul>
<li><code>-DCMAKE_BUILD_TYPE=Debug</code>: you should always set that when testing as you will get DWARF debug symbols and debugging instruments support.</li>
<li><code>-DCMAKE_EXPORT_COMPILE_COMMANDS=YES</code>: useful when you’re using a C++ linter, such as <a href="https://github.com/cquery-project/cquery">cquery</a>.</li>
</ul>
<h3>Building for JNI</h3>
<p>Building with JNI (Java Native Interface), allows you to use the library with Java based software. In order to enable JNI mode use</p>
<div class="fragment"><div class="line">cmake -DTARGET_JNI=ON</div></div><!-- fragment --><p>This will add JNI files to the library compilation and remove tests. You need at least a JDK 7 to build for JNI (OpenJDK or Oracle JDK)</p>
<h3>Build library on docker</h3>
<p>You can build the core library or debug it from a docker image:</p>
<ol type="1">
<li>Build the image <code>docker build -t ledger-core-env .</code> (considering that you are currently at the root of the repository)</li>
<li>Run the image <code>docker run -ti --cap-add=SYS_PTRACE --security-opt seccomp=unconfined ledger-core-env</code></li>
<li>Notice that stopping a container will wipe it. If you need multiple instance over the same container one way is to start the container as a daemon and then get a shell on it.<ol type="a">
<li>Start the container as daemon <code>docker run --cap-add=SYS_PTRACE --security-opt seccomp=unconfined -d ledger-core-env</code></li>
<li>Get the container ID with <code>docker ps</code></li>
<li>Open shells <code>docker exec -ti :container_id zsh</code> where :container_id has to be replaced by the container you got from <code>docker ps</code></li>
</ol>
</li>
</ol>
<p>Note: If you feel on fire you could use docker volumes to persist data.</p>
<h3>Build library with OpenSSL</h3>
<p>It is possible to build the library with embedded version of OpenSSL (which is advised for Android and iOS builds) or you can rely on OpenSSL provided by the system.</p>
<p>To build the library with system's OpenSSL you should configure the project by providing <code>-DSYS_OPENSSL=ON</code> option plus some additional variables to allow <code>cmake</code> to find OpenSSL library:</p>
<ul>
<li>Macos: <code>-DOPENSSL_ROOT_DIR=&lt;path-to-openssl-root-dir&gt;</code> is needed, for example, if you installed OpenSSL through <code>brew</code> you can pass: <code>-DOPENSSL_ROOT_DIR=/usr/local/opt/openssl</code>,</li>
</ul>
<p>-Linux: <code>-OPENSSL_SSL_LIBRARIES=&lt;path-to-openssl-libraries&gt; -DOPENSSL_INCLUDE_DIR=&lt;path-to-openssl-include-files&gt;</code>, for example, if you installed OpenSSL through <code>apt-get</code> it will look like:</p>
<p><code>-DOPENSSL_SSL_LIBRARIES=/usr/lib/x86_64-linux-gnu -DOPENSSL_INCLUDE_DIR=/usr/include/openssl</code></p>
<p>In both cases we are supporting OpenSSL <code>1.0</code> and <code>1.1</code>. </p><h2>Documentation</h2>
<p>You can generate the Doxygen documentation by running the <code>doc</code> target (for instance, <code>make doc</code> with makefiles).</p>
<h2>Binding to node.js</h2>
<p>The library can be compiled and integrated as an node module in a pretty straightforward way. You will be interested in either using it, or making a new version of the node module.</p>
<h3>Using the node module</h3>
<p>The <a href="https://github.com/LedgerHQ/lib-ledger-core-node-bindings">lib-ledger-core-node-bindings</a> repository contains the node.js bindings you will need to interface with <code>lib-ledger-core</code>. You can either clone the git repository or simply install from <code>npm</code> directly:</p>
<div class="fragment"><div class="line">npm i @ledgerhq/ledger-core</div></div><!-- fragment --><h3>Generating a new node module for your system</h3>
<p>Generating bindings is a several steps process:</p>
<ol type="1">
<li>First, you need to make some changes to <code>lib-ledger-core</code> and generate a fresh version of <code>lib-ledger-core</code>.</li>
<li>Clone <a href="https://github.com/LedgerHQ/lib-ledger-core-node-bindings">lib-ledger-core-node-bindings</a> and edit the <code>package.json</code> file in order to remove or comment the <code>"preinstall"</code> line in <code>"scripts"</code>.</li>
<li>In the folder of <code>lib-ledger-core</code>, run the <code>tools/generateBindings.sh</code> script by giving it the path to the bindings (i.e. where you cloned <a href="https://github.com/LedgerHQ/lib-ledger-core-node-bindings">lib-ledger-core-node-bindings</a>) and as second argument the path to the directory where you built the <code>lib-ledger-core</code> — it should be something like <code>$(your-lib-ledger-core-dir)/../lib-ledger-core-build</code> or <code>$(your-lib-ledger-core-dir)/build</code>.<ul>
<li>This script requires an up-to-date <b>djinni</b>. To ensure it’s correctly up to date, go into <code>lib-ledger-core/djinni</code> and run <code>get fetch origin --prune &amp;&amp; git rebase origin/master</code>.</li>
<li>You will need <code>sbt</code> and <code>java8</code> for a complete, working install.</li>
<li>The script will generate files in both projects. You’re advised to remove the ones created in <code>lib-ledger-core</code> — if any — with a <code>git checkout .</code> and/or <code>git reset .</code>.</li>
</ul>
</li>
<li><code>cd</code> into <code>lib-ledger-core-bindings</code> and run <code>yarn</code> to generate the bindings.</li>
<li>You will have the module in <code>build/Release/ledgerapp_nodejs.node</code> in the bindings project.</li>
<li><code>npm i</code> should install your own version.</li>
</ol>
<h2>Test NodeJs</h2>
<div class="fragment"><div class="line">node ledger-core-samples/nodejs/tests/wallet-pool-test.js</div></div><!-- fragment --> <h2>Support</h2>
<h3>Libcore:</h3>
<p>Libcore can be built for following OSes:</p><ul>
<li>MacOS: minimum supported version is <code>macOS 9.0</code>, with <code>x86_64</code> architecture,</li>
<li>Linux: Debian (stretch), Ubuntu and Arch are supported, with <code>x86_64</code> architecture,</li>
<li>Windows: 64-bit architecture is built with <code>MSVC</code> (starting from Visual Studio 15), 32-bit is built with <code>MinGW</code>,</li>
<li>iOS: <code>x86_64</code>, <code>armv7</code> and <code>arm64</code> architectures are supported, minimum supported version is <code>iOS 10.0</code>,</li>
<li>Android: <code>x86</code>, <code>armeabi-v7a</code> and <code>arm64-v8a</code> architectures are supported, minimum supported version is <code>Android 7 (API 24)</code> (Java 8 is needed). <h3>Bindings:</h3>
</li>
</ul>
<ul>
<li>NodeJS bindings:<ul>
<li>Please use <code>node</code> with version <code>&gt;=8.4.0</code> and <code>&lt;9.0.0</code> (other versions are not tested (yet)),</li>
<li>Node-gyp is used to build native module and requires <code>python</code> with version <code>2.7.x</code>.</li>
</ul>
</li>
</ul>
<h2>Developement guidelines</h2>
<h3>CI</h3>
<p>You are advised to link your GitHub account to both <a href="https://circleci.com">CircleCI</a> and <a href="https://www.appveyor.com">Appveyor</a> by signing-in. Because we are using shared runners and resources, we have to share CI power with other teams. It’s important to note that we don’t always need to run the CI. Example of situations when we do not need it:</p>
<ul>
<li>When we are updating documentation.</li>
<li>When we are changing a tooling script that is not part of any testing suite (yet).</li>
<li>When we are making a <em>WIP</em> PR that doesn’t require running the CI until everyone has agreed on the code (this is a tricky workflow but why not).</li>
</ul>
<p>In those cases, please include the <code>[skip ci]</code> or <code>[ci skip]</code> text <b>in your commit message’s title</b>. You could tempted to put it in the body of your message but that will not work with <a href="https://www.appveyor.com">Appveyor</a>.</p>
<p>Finally, it’s advised to put it on every commit and rebase at the end to remove the <code>[skip ci]</code> tag from your commits’ messags to have the CI re-enabled, but some runners might be smart enough to do it for all commits in the PR.</p>
<p>Rebasing is done easily. If your PR wants to merge <code>feature/stuff -&gt; develop</code>, you can do something like this — assuming you have cloned the repository with a correctly set <code>origin</code> remote:</p>
<div class="fragment"><div class="line">git checkout feature/stuff</div><div class="line">git rebase -i origin/develop</div></div><!-- fragment --><p>Change the <code>pick</code> to <code>r</code> or <code>reword</code> at the beginning of each lines <b>without changing the text of the commits</b> — this has no effect. Save the file and quit. You will be prompted to change the commits’ messages one by one, allowing you to remove the <code>[skip ci]</code> tag from all commits.</p>
<h2>Q/A and troubleshooting</h2>
<h3>I have updated an include file and test code doesn’t see the changes!</h3>
<p>Currently, interface files (headers, .hpp) <b>are not linked by copied directly into the test directory</b>. That means that every time you make a change in the interface that is tested by any code in core/test/, you need to update the copy.</p>
<p>Just run this command:</p>
<div class="fragment"><div class="line">cd $your_build_folder</div><div class="line">rm -rf CMakeFiles CMakeCache.txt</div></div><!-- fragment --><h3>I have upgraded my macOSX system and now I can’t compile anymore.</h3>
<p>Especially if you’ve upgraded to Mojave for which there are some breaking changes, you will need to perform some manual tasks — here, for macOSX Mojave:</p>
<div class="fragment"><div class="line">xcode-select --install</div><div class="line">open /Library/Developer/CommandLineTools/Packages/macOS_SDK_headers_for_macOS_10.14.pkg</div></div><!-- fragment --> </div></div><!-- PageDoc -->
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.15
</small></address>
</body>
</html>
